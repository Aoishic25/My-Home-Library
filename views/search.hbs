<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Books by Author</title>
    <link rel="stylesheet" href="/style5.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <nav>
        <a href="/">Back</a>
    </nav>
    <h1>Search for a Book by Author</h1>
    <form id="search-form">
        <label for="tables">Select Table:</label>
        <select name="table" id="tables" required>
            <option value="" disabled selected>Select a table</option>
            {{#each tables}}
                <option value="{{this}}">{{this}}</option>
            {{/each}}
        </select>

        <label for="authors">Choose author:</label>
        <select name="author" id="authors" required>
            <option value="" disabled selected>Select an author</option>
        </select>

        <button type="submit">Search</button>
    </form>

    <h2>Book Titles</h2>
    <table id="book-titles" border="1">
        <thead>
            <tr>
                <th>Title</th>
            </tr>
        </thead>
        <tbody>
            <!-- Titles will be dynamically inserted here -->
        </tbody>
    </table>

    <script>
        $(document).ready(function() {
            $('#tables').change(function() {
                const selectedTable = $(this).val();

                // Clear previous author dropdown values
                $('#authors').empty().append('<option value="" disabled selected>Select an author</option>');

                if (selectedTable) {
                    $.ajax({
                        type: 'POST',
                        url: '/fetch-authors',
                        data: { table: selectedTable },
                        success: function(data) {
                            // Populate the authors dropdown with the fetched values
                            data.forEach(function(author) {
                                $('#authors').append(`<option value="${author}">${author}</option>`);
                            });
                        },
                        error: function(err) {
                            console.error('Error fetching authors:', err);
                        }
                    });
                }
            });

            // When the form is submitted, fetch the book titles
            $('#search-form').submit(function(e) {
                e.preventDefault();

                const selectedTable = $('#tables').val();
                const selectedAuthor = $('#authors').val();

                if (!selectedTable || !selectedAuthor) {
                    alert('Please select both a table and an author');
                    return;
                }

                $.ajax({
                    type: 'POST',
                    url: '/fetch-titles',
                    data: {
                        table: selectedTable,
                        author: selectedAuthor
                    },
                    success: function(titles) {
                        const tableBody = $('#book-titles tbody');
                        tableBody.empty();  // Clear previous titles

                        if (titles.length === 0) {
                            tableBody.append('<tr><td>No titles found</td></tr>');
                        } else {
                            titles.forEach(function(title) {
                                tableBody.append(`<tr><td>${title}</td></tr>`);
                            });
                        }
                    },
                    error: function(err) {
                        console.error('Error fetching titles:', err);
                    }
                });
            });
        });
    </script>
</body>
</html>